# Initial setup
mkdir djangoapidemo
cd djangoapidemo
python -m venv djangoapienv
code .
source djangoapienv/bin/activate

# Install requirements
make requirements.txt:
----
django>=5.0
djangorestframework >= 3.14.0
markdown
django-filter

pip install -r requirements.txt

# First run
django-admin startproject djangoapidemo
cd djangoapidemo
python manage.py runserver

Close the runserver with Ctrl+C

# First migrations
python manage.py migrate

# Make the first app
python manage.py startapp api
Make the templates directory
    Make home.html
    <html>
        <body>
            <h1>Home page</h1>
        </body>
    </html>
Add the views
        In api.views.py
        def home(request):
            return render(request, 'home.html')
        
Add api to settings.py INSTALLED_APPS
Add BASE_DIR / "api/templates", to TEMPLATES DIRS[]
In djangoapi.urls.py:
        from api import views as api_views
        urlpatterns = [
            path("", api_views.home, name="home"),
            path('admin/', admin.site.urls),
        ]

python manage.py runserver
See the changes!

# First model
Make the model

    class Amendment(models.Model):
        date = models.DateField()
        text = models.TextField()
        title = models.CharField(max_length=100)

        def __str__(self):
            return self.title
    
python manage.py makemigrations
Show the migration file
python manage.py migrate

# Add data
Now, add an amendment
python3 manage.py shell
>>> from api.models import Amendment
https://constitution.congress.gov/constitution/amendment-1/
>>> a1 = Amendment(title="First Amendment", text="Congress shall make no law respecting an establishment of religion, or prohibiting the free exercise thereof; or abridging the freedom of speech, or of the press; or the right of the people peaceably to assemble, and to petition the Government for a redress of grievances.", date="December 15, 1971")
>>> a1.save()

# Show first data
## Update the view
In api.views.py:
    def home(request):
        amendments = Amendment.objects.all()
        return render(request, 'home.html', context={'amendments': amendments})
## Update the home page template to show the amendment
<h2>Amendments</h2>
<ol>
    {% for item in amendments %}
        <li>{{ item.title }}: {{ item.date }}</li>
    {% endfor %}
</ol>

## Run the server and see the changes
python manage.py runserver


# Add the API
## Settings configuration
In settings.py:
    Add 'rest_framework' to INSTALLED_APPS
    Add settings:
    REST_FRAMEWORK = {
        # Use Django's standard `django.contrib.auth` permissions,
        # or allow read-only access for unauthenticated users.
        'DEFAULT_PERMISSION_CLASSES': [
            'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly'
        ]
    }

## Create the serializer for the Amendment model
    In api.serializers.py:

from rest_framework import serializers
from api.models import Amendment

class AmendmentSerializer(serializers.HyperlinkedModelSerializer):
    class Meta:
        model = Amendment
        fields = ['date', 'text', 'title', 'id']

## View for DRF
    In api.views.py:

from rest_framework import viewsets
from api.serializers import AmendmentSerializer
from api.models import Amendment

class AmendmentViewSet(viewsets.ModelViewSet):
    queryset = Amendment.objects.all() # we can sort and filter here too
    serializer_class = AmendmentSerializer

## Add the router
In urls.py
from rest_framework import routers

router = routers.DefaultRouter()
router.register(r'amendments', api_views.AmendmentViewSet, basename="Amendment")

url patterns:
    path('api-auth/', include('rest_framework.urls', namespace='rest_framework')),
    path("api/", include(router.urls)),

## Run the server and see the changes
http://localhost:8000/api/


## Create a superuser
python manage.py createsuperuser
    admin / password / p@ssw0rd!

## Login on the API site
## Create a second amendment
## Create a third amendment
## Show the amendments on the home page
## Delete an amendment on the CLI
a = Amendment.objects.get(id=3)
a.delete()
## pip install requests
## get the amendments with requests
import requests
r = requests.get("http://localhost:8000/api/amendments/")
amendments = r.json()
amendments
amendments[0]["title"]